---
title: "PAMES"
author: "Dario Romagnoli"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{PAMES}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

**PAMES** (*Purity Assessment by MEthylation Sites*) is a tool developed 
for estimating purity of tumor samples.
The default process for data obtained with Illumina BeadChip 
(450k or 27k) is characterized by two main steps:

1. computation of AUC (`compute_AUC`)
2. selection of informative CpG __sites__ (`select_informative_sites`)
3. estimation of purity (`compute_purity`)

For data generated by Bisulphite Sequencing (BS) technology, the purity estimation 
requires one previous additional steps:

* reducing the data to CpG islands (`reduce_to_islands`)

Then, one can proceed as before (beware the different *select* function):

1. computation of AUC (`compute_AUC`)
2. selection of informative CpG __islands__ (`select_informative_islands`)
3. estimation of purity (`compute_purity`)

*Mapping* step converts beta values from different CpG sites 
to a single beta value associated to the CpG island which CpG sites belong 
to (CpG sites located outsite CpG islands are discared).

A set of pre-computed CpG sites (for Illumina 450k) and CpG islands for 14 cancer
types are available with [PAMESdata](https://github.com/cgplab/PAMESdata) package.

## Examples

Below are showed examples of the steps required to run the analysis 
with different situations.

### Illumina 450k using pre-computed informative CpG sites

    purity_brca <- compute_purity(BRCA_matrix, BRCA_sites)
    
### Illumina 27k (different genome version) computing a new set of informative CpG sites

    auc_scores <- compute_AUC(tumor_matrix, control_matrix)
    cpg_sites <- select_informative_sites(tumor_matrix, control_matrix, auc_scores,
                                          genome="hg38")
    tumor_purity <- compute_purity(tumor_matrix, cpg_sites)

### Bisulphite Sequencing using pre-computed informative CpG islands

    bs_brca_reduced <- reduce_to_islands(bs_BRCA, cpg_sites_coord)
    bs_brca_purity <- compute_purity(bs_BRCA_redux, BRCA_islands)
    
### Bisulphite Sequencing computing a new set of informative CpG islands

Tip: "CpG island-reducing"" is a time consuming step so it's preferable to 
perform it on one single matrix with tumor and normal samples (example below) 
together and than to split the matrix.

    |           | tumor1| tumor2| control1| control2|
    |:----------|------:|------:|--------:|--------:|
    |chr1-10470 |   0.98|   0.60|     0.80|     0.06|
    |chr1-10472 |   0.55|   0.24|     0.26|     0.56|
    |chr1-10485 |   0.60|   0.04|     0.10|     1.00|
    |chr1-10497 |   0.69|   0.64|     0.57|     0.80|
    

    bs_gbm_redux <- reduce_bs_data(bs_brca, cpg_sites_coord)
    bs_info_sites <- select_informative_islands(bs_brca_redux[, idx_tumor], 
                                                bs_brca_redux[, idx_control])
    bs_brca_purity <- compute_purity(bs_brca_redux, bs_info_sites)
    
